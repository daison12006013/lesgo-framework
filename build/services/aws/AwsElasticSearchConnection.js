"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _awsSdk=_interopRequireDefault(require("aws-sdk")),_elasticsearch=require("@elastic/elasticsearch"),_SignedRequest=_interopRequireDefault(require("./SignedRequest")),_LesgoException=_interopRequireDefault(require("../../exceptions/LesgoException"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}class AwsElasticSearchConnection extends _elasticsearch.Connection{constructor(a){super(a),this.opts=a}async request(a,b){try{const c=await this.getCredentials();if(!this.opts.awsRegion)throw new _LesgoException.default("Please provide the awsRegion!");const d=(0,_SignedRequest.default)(_awsSdk.default,{endpoint:this.opts.url.host,region:this.opts.awsRegion,service:"es",awsCreds:c});d.send({method:a.method,path:a.path,message:a.body,headers:a.headers,rawResponse:!0},b)}catch(a){b(a)}}getCredentials(){return new Promise((a,b)=>null===_awsSdk.default.config.credentials?b(new Error("Invalid AWS Credentials")):void _awsSdk.default.config.getCredentials((c,d)=>c?b(c):a(d)))}}exports.default=AwsElasticSearchConnection;